{
  "openapi": "3.0.0",
  "servers": [
    {
      "url": "http://petstore.swagger.io/v1"
    }
  ],
  "paths": {},
  "components": {
    "schemas": {
      "ManagedImage": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "ManagedImage"
            ]
          },
          "imageId": {
            "type": "string"
          }
        },
        "required": [
          "type",
          "imageId"
        ]
      },
      "PlatformImagePlanInfo": {
        "title": "Platform Image Plan Info",
        "type": "object",
        "properties": {
          "planName": {
            "type": "string"
          },
          "planProduct": {
            "type": "string"
          },
          "planPublisher": {
            "type": "string"
          }
        },
        "required": [
          "planName",
          "planProduct",
          "planPublisher"
        ]
      },
      "PlatformImage": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "PlatformImage"
            ]
          },
          "offer": {
            "type": "string"
          },
          "planInfo": {"$ref": "#/components/schemas/PlatformImagePlanInfo"},
          "publisher": {
            "type": "string"
          },
          "sku": {
            "type": "string"
          },
          "version": {
            "type": "string"
          }
        },
        "required": [
          "type",
          "offer",
          "publisher",
          "sku",
          "version"
        ]
      },
      "SharedImageVersion": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "SharedImageVersion"
            ]
          },
          "imageVersionId": {
            "type": "string"
          }
        },
        "required": [
          "type",
          "imageVersionId"
        ]
      },
      "V2LayerAuthor": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "maxLength": 100
          },
          "email": {
            "type": "string",
            "format": "email"
          }
        },
        "required": [
          "name"
        ]
      },
      "V2LayerNetworkWhitelistedPublicIP": {
        "type": "object",
        "properties": {
          "target": {
            "description": "IP or CIDR range",
            "type": "string",
            "example": "1.1.1.1/24"
          },
          "port": {
            "description": "port or port range",
            "type": "string",
            "pattern": "^([0-9]{1,5}|[0-9]{1,5}-[0-9]{1,5})$",
            "minLength": 1,
            "maxLength": 11,
            "example": "1234-1236"
          }
        },
        "required": [
          "target"
        ]
      },
      "V2LayerNetworkWhitelistedInternalIPs": {
        "type": "object",
        "properties": {
          "hostname": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?$",
            "minLength": 1,
            "maxLength": 63
          },
          "port": {
            "description": "port or port range",
            "type": "string",
            "pattern": "^([0-9]{1,5}|[0-9]{1,5}-[0-9]{1,5})$",
            "minLength": 1,
            "maxLength": 11,
            "example": "1234-1236"
          }
        },
        "required": [
          "hostname"
        ]
      },
      "V2LayerNetworkConfig": {
        "type": "object",
        "properties": {
          "http_proxy_whitelist": {
            "description": "HTTP(s) hosts that are whitelisted in the proxy. Note that the application must be configured to use the proxy or support Windows IE proxy settings",
            "type": "array",
            "maxItems": 100,
            "items": {
              "type": "string",
              "pattern": "^[\\w\\-.*]+:[\\d*]+$",
              "description": "Hostname:port combination, supports * wildcards"
            }
          },
          "whitelisted_public_ips": {
            "description": "List of IPs or CIDR ranges that are whitelisted for outgoing connections. These should be public IPs",
            "type": "array",
            "maxItems": 50,
            "items": {
              "$ref": "#/components/schemas/V2LayerNetworkWhitelistedPublicIP"
            }
          },
          "whitelisted_internal_ips": {
            "type": "array",
            "maxItems": 50,
            "items": {"$ref": "#/components/schemas/V2LayerNetworkWhitelistedInternalIPs"}
          }
        }
      },
      "V2Layer": {
        "description": "Properties schema for an image layer",
        "type": "object",
        "properties": {
          "version": {
            "type": "string",
            "enum": [
              "v2"
            ]
          },
          "name": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9-.]+$",
            "minLength": 3,
            "maxLength": 25
          },
          "author": {
            "$ref": "#/components/schemas/V2LayerAuthor"
          },
          "base_image": {
            "oneOf": [
              {
                "$ref": "#/components/schemas/ManagedImage"
              },
              {
                "$ref": "#/components/schemas/PlatformImage"
              },
              {
                "$ref": "#/components/schemas/SharedImageVersion"
              }
            ],
            "discriminator": {
              "propertyName": "type",
              "mapping": {
                "ManagedImage": "#/components/schemas/ManagedImage",
                "PlatformImage": "#/components/schemas/PlatformImage",
                "SharedImageVersion": "#/components/schemas/SharedImageVersion"
              }
            }
          },
          "network": {
            "$ref": "#/components/schemas/V2LayerNetworkConfig"
          },
          "platform_version": {
            "description": "The version of the AVD platform this layer expects and requires to work",
            "type": "string",
            "enum": [
              "2"
            ]
          }
        },
        "required": [
          "version",
          "name",
          "author",
          "platform_version"
        ]
      },
      "V2Bundle": {
        "type": "object",
        "properties": {
          "version": {
            "type": "string",
            "enum": [
              "v2"
            ]
          },
          "cli_version": {
            "type": "string",
            "maxLength": 50
          },
          "layers": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/V2Layer"
            },
            "minItems": 1,
            "maxItems": 50
          }
        },
        "required": [
          "version",
          "cli_version",
          "layers"
        ]
      }
    }
  },
  "info": {
    "title": "AVD image types",
    "version": "x"
  }
}
